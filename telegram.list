# =======================================================
# 规则名称: Telegram Ultimate (Watertight)
# 覆盖范围: Telegram App, Web, Instant View, 链接跳转
# 核心策略: IP-ASN 直连兜底 (解决一直在转圈的问题)
# 适用 App: Telegram X, Nicegram, iMe, Swiftgram, Turrit
# =======================================================

# [Part 1: 核心域名 & 链接跳转]
# t.me 是最常用的短链，必须加
DOMAIN-SUFFIX,telegram.org
DOMAIN-SUFFIX,telegram.me
DOMAIN-SUFFIX,telegram.dog
DOMAIN-SUFFIX,t.me
DOMAIN-SUFFIX,tx.me
DOMAIN-SUFFIX,tdesktop.com
DOMAIN-SUFFIX,telegra.ph
DOMAIN-SUFFIX,telesco.pe
DOMAIN-SUFFIX,tg.dev
DOMAIN-SUFFIX,graph.org
DOMAIN-SUFFIX,legra.ph

# [Part 2: 静态资源与 CDN]
# 头像、贴纸(Sticker)、图片加载
DOMAIN-SUFFIX,telegram-cdn.org
DOMAIN-SUFFIX,tgusercontent.com
DOMAIN-SUFFIX,cdn-telegram.org

# [Part 3: 暴力关键字 (Keywords)]
# 防止各种第三方客户端或未收录的短链
DOMAIN-KEYWORD,telegram
DOMAIN-KEYWORD,nicegram

# =======================================================
# [Part 4: 协议层兜底 (User-Agent)]
# 覆盖官方 App 及主流第三方“魔改”客户端
# =======================================================
USER-AGENT,Telegram*
USER-AGENT,Nicegram*
USER-AGENT,iMe*
USER-AGENT,Turrit*
USER-AGENT,Swiftgram*
USER-AGENT,Unigram*

# =======================================================
# [Part 5: 物理层兜底 (IP-ASN) - ***核心重点***]
# Telegram 不讲武德，直接连接 IP。
# 只要目标 IP 属于 Telegram 的自治域，必须走代理。
# 缺了下面这些，你的 Telegram 就会一直 "Connecting..."
# =======================================================

# AS62041: Telegram Messenger LLP (欧洲/全球核心 DC2/DC4)
# 这是最主要的 ASN，承载了绝大部分流量
IP-ASN,62041

# AS59930: Telegram Messenger Inc (美洲/迈阿密 DC1/DC3)
# 也是 IP-CIDR 91.108.56.0/22 等网段的归属地
IP-ASN,59930

# AS44907: Telegram Messenger Inc (部分亚太/新加坡基础设施)
IP-ASN,44907

# AS211157: Telegram Messenger Inc (新兴/辅助节点)
IP-ASN,211157

# AS60239: Telegram (部分旧的或备用前置代理)
IP-ASN,60239
